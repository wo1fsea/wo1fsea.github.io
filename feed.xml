<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="zh-CN">
  <generator uri="http://jekyllrb.com" version="3.4.3">Jekyll</generator>
  
  
  <link href="https://wo1fsea.github.io/feed.xml" rel="self" type="application/atom+xml" />
  <link href="https://wo1fsea.github.io/" rel="alternate" type="text/html" hreflang="zh-CN" />
  <updated>2017-04-16T15:06:44+00:00</updated>
  <id>https://wo1fsea.github.io//</id>

  
    <title type="html">A Blog</title>
  

  
    <subtitle>A Blog</subtitle>
  

  
    <author>
        <name>wo1fsea (Quanyong Huang)</name>
      
      
    </author>
  

  
  
    <entry>
      
      <title type="html">Hello, Jekyll!</title>
      
      <link href="https://wo1fsea.github.io/2017/04/16/Hello_Jekyll/" rel="alternate" type="text/html" title="Hello, Jekyll!" />
      <published>2017-04-16T02:38:34+00:00</published>
      <updated>2017-04-16T02:38:34+00:00</updated>
      <id>https://wo1fsea.github.io/2017/04/16/Hello_Jekyll</id>
      <content type="html" xml:base="https://wo1fsea.github.io/2017/04/16/Hello_Jekyll/">&lt;p&gt;把 Github 上这个 Blog 从 &lt;a href=&quot;https://hexo.io&quot;&gt;Hexo&lt;/a&gt; 迁移到了 &lt;a href=&quot;http://jekyllrb.com&quot;&gt;Jekyll&lt;/a&gt; , 原因本是贪图 Jekyll 是 Github Page 官方支持的，可以不用在本地生成直接提交原始文件由 Github Page 生成转换后的页面。后来发现，Github Page 并不支持插件，直接使用默认的转换无法生成 categories 。辗转又发现了，其实可以使用 &lt;a href=&quot;https://travis-ci.org&quot;&gt;Travis CI&lt;/a&gt; 自动跑运行生成过程并提交到相应的 Github 分支上，就在这个 Blog 的 Repository 里部署了 Travis CI 自动从 draft 分支生成页面提交到 master 里。这个 &lt;a href=&quot;https://github.com/wo1fsea/wo1fsea.github.io/blob/draft/.travis.yml&quot;&gt;.travis.yml&lt;/a&gt; 里还是很容易看出是具体怎么做的。
今天把原来的数据全部转换了一下到 Jekyll 的格式上，主要是修改了文件名和每篇文章前面的描述。使用了 &lt;a href=&quot;https://github.com/yous/whiteglass&quot;&gt;whiteglass&lt;/a&gt; 主题，主题设置的字体不是很适合中文，修改了一下页面字体。使用 Jekyll 还有另一个好处，即是 Jekyll 本身支持 LaTeX 公式，可以在 Markdown 里面方便地书写 LaTeX 公式，详见 &lt;a href=&quot;https://jekyllrb.com/docs/extras/&quot;&gt;Math SupportPermalink&lt;/a&gt; 。原来 &lt;a href=&quot;https://wo1fsea.github.io/2016/11/26/Survival_Skill_Markdown_and_LaTex_Formulas/&quot;&gt;生存技能 01. Markdown &amp;amp; LaTex Formulas&lt;/a&gt; 里用 google chart api 生成 LaTex 公式图片的过程可以不必使用了。&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>wo1fsea (Quanyong Huang)</name>
          
          
        </author>
      

      
        <category term="Daily" />
      

      

      
        <summary type="html">把 Github 上这个 Blog 从 Hexo 迁移到了 Jekyll , 原因本是贪图 Jekyll 是 Github Page 官方支持的，可以不用在本地生成直接提交原始文件由 Github Page 生成转换后的页面。后来发现，Github Page 并不支持插件，直接使用默认的转换无法生成 categories 。辗转又发现了，其实可以使用 Travis CI 自动跑运行生成过程并提交到相应的 Github 分支上，就在这个 Blog 的 Repository 里部署了 Travis CI 自动从 draft 分支生成页面提交到 master 里。这个 .travis.yml 里还是很容易看出是具体怎么做的。 今天把原来的数据全部转换了一下到 Jekyll 的格式上，主要是修改了文件名和每篇文章前面的描述。使用了 whiteglass 主题，主题设置的字体不是很适合中文，修改了一下页面字体。使用 Jekyll 还有另一个好处，即是 Jekyll 本身支持 LaTeX 公式，可以在 Markdown 里面方便地书写 LaTeX 公式，详见 Math SupportPermalink 。原来 生存技能 01. Markdown &amp;amp; LaTex Formulas 里用 google chart api 生成 LaTex 公式图片的过程可以不必使用了。</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">生存技能 01. Markdown &amp;amp; LaTex Formulas</title>
      
      <link href="https://wo1fsea.github.io/2016/11/26/Survival_Skill_Markdown_and_LaTex_Formulas/" rel="alternate" type="text/html" title="生存技能 01. Markdown &amp; LaTex Formulas" />
      <published>2016-11-26T16:21:11+00:00</published>
      <updated>2016-11-26T16:21:11+00:00</updated>
      <id>https://wo1fsea.github.io/2016/11/26/Survival_Skill_Markdown_and_LaTex_Formulas</id>
      <content type="html" xml:base="https://wo1fsea.github.io/2016/11/26/Survival_Skill_Markdown_and_LaTex_Formulas/">&lt;p&gt;做笔记写文档最恼人的，可能就是文档标题格式字体字号等等的设置了。所幸用 Markdown 之后，都不用怎么考虑这些细节问题。然而，偶然读书遇到公式，想要记录下来还是挺麻烦的。最好的方法可能是截图，但是还是有格式不一致，不能二次编辑等等问题。这两天发现 atom 的 MPP 插件居然支持 LaTex 的公式编辑和渲染，再配合 google api 的 LaTex 公式渲染，正好解决了这个困扰已久的问题。&lt;/p&gt;

&lt;p&gt;恰好最近正在反思，自己平时看书翻资料时间花不少，但记录总结的却不多。正好借机培养下习惯，从一些基础的东西开始整理。掌握这些工具，怎么看都是生存技能，所以这篇叫《生存技能 01. Markdown &amp;amp; LaTex Formulas》，从用 Markdown 和 LaTex 开始。&lt;/p&gt;

&lt;p&gt;&lt;!-- more --&gt;&lt;/p&gt;

&lt;p&gt;## Markdown&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Markdown 是一种轻量级标记语言，创始人为约翰·格鲁伯（John Gruber）。它允许人们“使用易读易写的纯文本格式编写文档，然后转换成有效的XHTML(或者HTML)文档”。[4]这种语言吸收了很多在电子邮件中已有的纯文本标记的特性。 – wikipedia&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;更具体的介绍可见 &lt;a href=&quot;http://daringfireball.net/projects/markdown/&quot;&gt;Markdown官方主页&lt;/a&gt; 。&lt;/p&gt;

&lt;p&gt;下面列出 Markdown 语法的基本元素。&lt;/p&gt;

&lt;h3&gt;标题&lt;/h3&gt;

&lt;p&gt;Markdown 标题可以选用下列两种风格：&lt;/p&gt;

&lt;p&gt;风格1:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;标题一
===

标题二
---
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;或者，风格2，由1到6个#开头的标题形式：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# 标题一

## 标题二

###### 标题六
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3&gt;引用&lt;/h3&gt;

&lt;p&gt;Markdown 引用使用 &amp;gt; 符号作为行起始字符，如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;gt; 引用
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;多行引用可写作：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;gt; 引用行1
引用行2
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;或：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;gt; 引用行1
&amp;gt; 引用行2
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3&gt;列表&lt;/h3&gt;

&lt;p&gt;无序列表写作：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;* a
* b
* c
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;或：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;+ a
+ b
+ c
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;或：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;- a
- b
- c
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;有序列表：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1. a
2. b
3. c
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;或：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1. a
1. b
1. c
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3&gt;表格&lt;/h3&gt;

&lt;p&gt;在 Markdown 中使用如下格式：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;|h1  |h2  |h3  |
|:---|:--:|---:|
|v1  |v2  |v3  |
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;将生成下列表格：&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;h1&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;h2&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;h3&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;v1&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;v2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;v3&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3&gt;代码块&lt;/h3&gt;

&lt;p&gt;Markdown 中缩进一个字表符或者4个空格表示一个代码块：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;这是文章。
    这是代码块。
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;或者使用&lt;/p&gt;

&lt;h3&gt;分割线&lt;/h3&gt;

&lt;p&gt;单行使用三个以上的下划线，星号，减号可以生成一个分割线。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;* * *

***

*****

- - -

---------------------------------------
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3&gt;图片&lt;/h3&gt;

&lt;p&gt;使用下列方式可插入图片：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;![图片描述](图片地址)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3&gt;链接&lt;/h3&gt;

&lt;p&gt;使用下列方式可插入链接：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[链接描述](链接地址)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3&gt;强调&lt;/h3&gt;

&lt;p&gt;在 Markdown 中，使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;*斜体*&lt;/code&gt; 表示 &lt;em&gt;斜体&lt;/em&gt;，使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;**粗体**&lt;/code&gt; 表示 &lt;strong&gt;粗体&lt;/strong&gt; 。&lt;/p&gt;

&lt;h2&gt;LaTex 公式&lt;/h2&gt;

&lt;h3&gt;上下标&lt;/h3&gt;

&lt;p&gt;在 LaTex 中，使用 ^ 表示上标， _ 表示下标。&lt;/p&gt;

&lt;p&gt;例如：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;\[ E=mc^2 \]
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;表示&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://chart.googleapis.com/chart?cht=tx&amp;amp;chl=E=mc^2&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3&gt;根式与分式&lt;/h3&gt;

&lt;p&gt;根式用\sqrt{·}来表示，分式用\frac{·}{·}来表示（第一个参数为分子，第二个为分母）。&lt;/p&gt;

&lt;p&gt;例如：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;\[ \Large x=\frac{-b\pm\sqrt{b^2-4ac}}{2a} \]
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;表示：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://chart.googleapis.com/chart?cht=tx&amp;amp;chl=\Large x=\frac{-b\pm\sqrt{b^2-4ac}}{2a}&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3&gt;运算符&lt;/h3&gt;

&lt;p&gt;下列运算符分别表示：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;\[ \pm\; \times \; \div\; \cdot\; \cap\; \cup\; \geq\; \leq\; \neq\; \approx\; \equiv\; \sum\; \prod\; \lim\; \int\; \]
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://chart.googleapis.com/chart?cht=tx&amp;amp;chl=\pm\; \times \; \div\; \cdot\; \cap\; \cup\; \geq\; \leq\; \neq\; \approx\; \equiv\; \sum\; \prod\; \lim\; \int\;&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3&gt;分隔符&lt;/h3&gt;

&lt;p&gt;各种括号可使用 \big, \Big, \bigg, \Bigg 调整大小。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;\[ \Bigg[\bigg[\Big[\big[[x]\big]\Big]\bigg]\Bigg] \]
\[ \Bigg\{\bigg\{\Big\{\big\{\{x\}\big\}\Big\}\bigg\}\Bigg\} \]
\[ \Bigg\langle\bigg\langle\Big\langle\big\langle\langle{x}\rangle\big\rangle\Big\rangle\bigg\rangle\Bigg\rangle \]
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://chart.googleapis.com/chart?cht=tx&amp;amp;chl=\Bigg(\bigg(\Big(\big((x)\big)\Big)\bigg)\Bigg)&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;http://chart.googleapis.com/chart?cht=tx&amp;amp;chl=\Bigg\{\bigg\{\Big\{\big\{\{x\}\big\}\Big\}\bigg\}\Bigg\}&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;http://chart.googleapis.com/chart?cht=tx&amp;amp;chl=\Bigg\langle\bigg\langle\Big\langle\big\langle\langle{x}\rangle\big\rangle\Big\rangle\bigg\rangle\Bigg\rangle&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3&gt;省略号&lt;/h3&gt;

&lt;p&gt;省略号有以下的表示：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;\[ x_1,x_2,\dots,x_n \quad 1,2,\cdots,n \quad \vdots \quad \ddots \]
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://chart.googleapis.com/chart?cht=tx&amp;amp;chl=x_1,x_2,\dots,x_n \quad 1,2,\cdots,n \quad \vdots \quad \ddots&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3&gt;矩阵&lt;/h3&gt;

&lt;p&gt;有下列形式的矩阵描述：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;\[ \begin{pmatrix} a&amp;amp;b\\c&amp;amp;d \end{pmatrix} \quad
\begin{bmatrix} a&amp;amp;b\\c&amp;amp;d \end{bmatrix} \quad
\begin{Bmatrix} a&amp;amp;b\\c&amp;amp;d \end{Bmatrix} \quad
\begin{vmatrix} a&amp;amp;b\\c&amp;amp;d \end{vmatrix} \quad
\begin{Vmatrix} a&amp;amp;b\\c&amp;amp;d \end{Vmatrix} \]
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://chart.googleapis.com/chart?cht=tx&amp;amp;chl=\begin{pmatrix} a%26b\\c%26d \end{pmatrix}&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;http://chart.googleapis.com/chart?cht=tx&amp;amp;chl=\begin{bmatrix} a%26b\\c%26d \end{bmatrix}&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;http://chart.googleapis.com/chart?cht=tx&amp;amp;chl=\begin{Bmatrix} a%26b\\c%26d \end{Bmatrix}&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;http://chart.googleapis.com/chart?cht=tx&amp;amp;chl=\begin{vmatrix} a%26b\\c%26d \end{vmatrix}&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;http://chart.googleapis.com/chart?cht=tx&amp;amp;chl=\begin{Vmatrix} a%26b\\c%26d \end{Vmatrix}&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3&gt;分段函数&lt;/h3&gt;

&lt;p&gt;分段函数可以用 cases 来实现。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;\[ y=\begin{cases}
-x,\quad x\leq 0 \\
x,\quad x&amp;gt;0
\end{cases} \]
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://chart.googleapis.com/chart?cht=tx&amp;amp;chl=y=\begin{cases} -x,\quad x\leq 0 \\x,\quad x&amp;gt;0\end{cases}&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3&gt;更多&lt;/h3&gt;

&lt;p&gt;详细的 LaTex 数学公式入门教程可参考 Michael Downes 的&lt;a href=&quot;/files/LaTex/short_math_guide.pdf&quot;&gt;Short Math Guide for LaTex&lt;/a&gt;。&lt;/p&gt;

&lt;h2&gt;将 LaTex 公式转换为图片&lt;/h2&gt;

&lt;p&gt;使用 google chart api 可以生成 LaTex 公式图片，接口如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://chart.googleapis.com/chart?cht=tx&amp;amp;chl=这里填写LaTex公式
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;例如：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://chart.googleapis.com/chart?cht=tx&amp;amp;chl=\Large x=\frac{-b\pm\sqrt{b^2-4ac}}{2a}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;结果为：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://chart.googleapis.com/chart?cht=tx&amp;amp;chl=\Large x=\frac{-b\pm\sqrt{b^2-4ac}}{2a}&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;需要注意的是在 url 中填入的公式中需要处理好 &lt;em&gt;&amp;amp;&lt;/em&gt; 等字符的转换。&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>wo1fsea (Quanyong Huang)</name>
          
          
        </author>
      

      
        <category term="Survival" />
      

      

      
        <summary type="html">做笔记写文档最恼人的，可能就是文档标题格式字体字号等等的设置了。所幸用 Markdown 之后，都不用怎么考虑这些细节问题。然而，偶然读书遇到公式，想要记录下来还是挺麻烦的。最好的方法可能是截图，但是还是有格式不一致，不能二次编辑等等问题。这两天发现 atom 的 MPP 插件居然支持 LaTex 的公式编辑和渲染，再配合 google api 的 LaTex 公式渲染，正好解决了这个困扰已久的问题。 恰好最近正在反思，自己平时看书翻资料时间花不少，但记录总结的却不多。正好借机培养下习惯，从一些基础的东西开始整理。掌握这些工具，怎么看都是生存技能，所以这篇叫《生存技能 01. Markdown &amp;amp; LaTex Formulas》，从用 Markdown 和 LaTex 开始。</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">谷阿莫带你十分钟看完 NavMesh 生成算法</title>
      
      <link href="https://wo1fsea.github.io/2016/08/21/A_Quick_Introduction_to_NavMesh/" rel="alternate" type="text/html" title="谷阿莫带你十分钟看完 NavMesh 生成算法" />
      <published>2016-08-21T04:32:22+00:00</published>
      <updated>2016-08-21T04:32:22+00:00</updated>
      <id>https://wo1fsea.github.io/2016/08/21/A_Quick_Introduction_to_NavMesh</id>
      <content type="html" xml:base="https://wo1fsea.github.io/2016/08/21/A_Quick_Introduction_to_NavMesh/">&lt;p&gt;&lt;em&gt;（本文配图皆来自《Crowds In A Polygon Soup: Next-Gen Path Planning》By David Miles, David Miles, David Miles, David Miles 与 《Study: Navigation Mesh Generation》By Stephen Pratt。“窃书不能算偷……窃书！……读书人的事，能算偷么？”）&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;大家好，我是谷阿莫，今天我给大家带来的是 NavMesh 的生成方法。&lt;/p&gt;

&lt;p&gt;这个算法从一个二维的简化例子开始讲起。当我们谈寻路算法的时候，在二维世界中，我们谈的是这样一个问题：&lt;/p&gt;

&lt;p&gt;如下图，左边有个走廊，中间是一个通道，右边是一个骷髅状的洞穴。起点在左，目标在右，如何找到一条最为合适的路径。&lt;/p&gt;

&lt;p&gt;在这个例子中，我们似乎很难直接求解一个合适的路径。主要的问题时，我们掌握的数据并不是一个抽象的结构化的数据。&lt;/p&gt;

&lt;p&gt;所以，首先，我们需要从问题中产生一个抽象的结构化的数据，用来简化问题求解。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[1].png&quot; alt=&quot;A Navigation Case in 2D&quot; /&gt;&lt;/p&gt;

&lt;!-- more --&gt;

&lt;p&gt;一个很朴素的思路，即是把地图数据栅格化（像素化）。在栅格化的地图上，至少可以通过搜索格子的方式（向周围四方向搜索或八方向）找到一条可行的路径，尽管很挫。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[2].png&quot; alt=&quot;Pixelize Voxelize&quot; /&gt;&lt;/p&gt;

&lt;p&gt;在栅格化的地图上做一个边缘提取，获得地图区域像素化后的内边缘，得到以下图形数据。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[3].png&quot; alt=&quot;Extract Edge&quot; /&gt;&lt;/p&gt;

&lt;p&gt;进一步，对锯齿化的边缘进行简化，得到一个简化的多边形地图区域。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[4].png&quot; alt=&quot;Simplify Polygon&quot; /&gt;&lt;/p&gt;

&lt;p&gt;可以使用下述方法对锯齿化的边缘进行简化。
选择两个点进行连线可得到一条简化的边。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[5].png&quot; alt=&quot;Simplify Polygon&quot; /&gt;&lt;/p&gt;

&lt;p&gt;找到离该简化边缘距离最远的点，将该点加入简化多变形的轮廓集合中，此时将产生替代旧边缘的两条新的简化边缘。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[6].png&quot; alt=&quot;Simplify Polygon&quot; /&gt;&lt;/p&gt;

&lt;p&gt;重复该过程，直到所有不在简化轮廓集合中的点距离简化的边缘距离都小于某阈值。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[7].png&quot; alt=&quot;Simplify Polygon&quot; /&gt;&lt;/p&gt;

&lt;p&gt;考虑到简化后的地图实际上很多存在很多可以直接通过直线联通的区域，我们可以进一步对这个地图做一个简单的划分。如下图，简化后的多边形地图区域可以分割为以下四个联通区域。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[8].png&quot; alt=&quot;Partition Into Convex Areas&quot; /&gt;&lt;/p&gt;

&lt;p&gt;分割区域按照以下算法进行：
两点间直线距离/两点边界距离 为 度量，当该值小于一定阈值时，进行区域分割。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[9].png&quot; alt=&quot;Convex Partitioning&quot; /&gt;&lt;/p&gt;

&lt;p&gt;该过程可以以递归的方式进行，整个过程复杂度&amp;lt;=O(Log(n)*n)，n为地图边。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[10].png&quot; alt=&quot;Recursively Partition&quot; /&gt;&lt;/p&gt;

&lt;p&gt;在完成区域分割后，我们可将整个地图数据视为一个图。即 左走廊 -&amp;gt; 中间通道 -&amp;gt; 右上洞穴区域 -&amp;gt; 右下洞穴区域。每个图节点区域中的两点都可以通过简单的直线路径相互连通。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[11].png&quot; alt=&quot;Convex Area Graph Complete&quot; /&gt;&lt;/p&gt;

&lt;p&gt;此时，我们可以用最短路径算法（如 Dijkstra ）来解决图节点间的寻路问题，而图节点内的路径可以简单的通过两点间连线完成。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[12].png&quot; alt=&quot;Pathfinding&quot; /&gt;&lt;/p&gt;

&lt;p&gt;上面例子是一个最简单的地图形式，下面考虑地图中带空洞（不可行走）区域的情况。下图在右边骷髅状洞穴区域添加两个不可行走的空洞。我们希望算法能够生成如下图表示的寻路路径。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[13].png&quot; alt=&quot;Holes in the Free-Space&quot; /&gt;&lt;/p&gt;

&lt;p&gt;使用和上文描述相同的步骤对地图进行像素画、边缘提取、多边形简化，可以得到如下地图数据。对每个空洞区域， 找到其和地图边界点距离最小的点，将该两点的连线作为额外边界添加到地图中。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[14].png&quot; alt=&quot;Splice Location&quot; /&gt;&lt;/p&gt;

&lt;p&gt;此时，地图退化为简单多边形（如下图所示），应用上述区域分割方法即可将地图进一步处理。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[15].png&quot; alt=&quot;Add Splice Segments&quot; /&gt;&lt;/p&gt;

&lt;p&gt;将地图抽象为如下联通区域图，即可在图上应用寻路算法。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[16].png&quot; alt=&quot;Convex Area Graph Complete&quot; /&gt;&lt;/p&gt;

&lt;p&gt;看一个三维空间上的例子，在3维空间中，我们需要将二维对地图数据的像素化过程变为对三维地图模型数据的体素化过程。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[17].png&quot; alt=&quot;Case in 3D&quot; /&gt;&lt;/p&gt;

&lt;p&gt;而事实上，在三维空间，模型数据表示的是不可进入的区域，在空间中，可以使用下图数据结构表示可行走的地图区域，每一个二维地图网格中存储一组由可行走区域上边界与下边界描述的数据。其中，可行走区域的下边界，即地板表面数据即是我们用来生成寻路网格的表面。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[18].png&quot; alt=&quot;Open Spans&quot; /&gt;&lt;/p&gt;

&lt;p&gt;如下图所示，使用寻路角色身高可以对可行走区域进行剔除。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[19].png&quot; alt=&quot;Walkable Surface Removal&quot; /&gt;&lt;/p&gt;

&lt;p&gt;考虑一个在三维空间中可行区域存在重叠的情况（如下图，形如一个盘旋的楼梯区域）。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[20].png&quot; alt=&quot;3D Overlap&quot; /&gt;&lt;/p&gt;

&lt;p&gt;直接使用和上文二维例子描述中相同的区域分割算法进行区域分割。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[21].png&quot; alt=&quot;3D Partitioning&quot; /&gt;&lt;/p&gt;

&lt;p&gt;上图所示地图可被分割为如下所示无重叠的两部分区域，即三维空间中地图重叠部分可在区域分割过程中解决。可对该两区域继续递归进行处理，生成上文描述的寻路区域数据。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[22].png&quot; alt=&quot;3D Partitioning&quot; /&gt;&lt;/p&gt;

&lt;p&gt;对于不同体型半径的，我们希望会生成不同的寻路路径，如下图例子所示，寻路角色体型半径过大无法通过中间连接区域，所以图中在上文生成的路径对体型半径过大的角色是不可行的。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[23].png&quot; alt=&quot;Different Creature Shapes&quot; /&gt;&lt;/p&gt;

&lt;p&gt;该问题可以在提取地图区域边缘时，向内多取一个角色体型半径生成特殊的寻路地图（即每种半径生成一个寻路网格）。同一地图数据，针对大体型角色，边缘提取过程后生成的寻路区域如下图所示。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[24].png&quot; alt=&quot;Different Creature Shapes&quot; /&gt;&lt;/p&gt;

&lt;p&gt;关于动态障碍，可采用在运行时改变寻路地图与动态障碍物重叠的节点数据完成，如下图所示，再添加动态障碍物前期望生成的寻路路径如左图，添加障碍物后期望生成的寻路路径如右图。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[25].png&quot; alt=&quot;Dynamic Obstacles&quot; /&gt;&lt;/p&gt;

&lt;p&gt;添加动态障碍物后，仅需在运行时替换与障碍物重叠的BCD节点，将其数据替换为B1B2C1C2D1D2D3节点，当障碍从地图中取出后再将界点恢复。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[26].png&quot; alt=&quot;Dynamic Obstacles&quot; /&gt;&lt;/p&gt;

&lt;p&gt;关于如何寻找寻路路径上的拐点。当路径跨多个联通区域时，可使用以下方法确定路径上的拐点。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[27].png&quot; alt=&quot;Finding the Next Corner&quot; /&gt;&lt;/p&gt;

&lt;p&gt;首先，确定路径上穿过的区域边缘。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[28].png&quot; alt=&quot;“Portals” Between Areas&quot; /&gt;&lt;/p&gt;

&lt;p&gt;顺序遍历边缘，记录最右的左边缘点与最左的右边缘点。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[29].png&quot; alt=&quot;Finding the Next Corner&quot; /&gt;
&lt;img src=&quot;/images/About_NavMesh/Image[30].png&quot; alt=&quot;Finding the Next Corner&quot; /&gt;&lt;/p&gt;

&lt;p&gt;当最右的左边缘点与最右的左边缘点发生重叠时，此时该两边缘点中较早遇到的即是路径上的拐点。将起始位置置为该拐点，继续进行相同处理，直至找到路径上所有拐点。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[31].png&quot; alt=&quot;Finding the Next Corner&quot; /&gt;&lt;/p&gt;

&lt;p&gt;这里就结束了，科科。&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>wo1fsea (Quanyong Huang)</name>
          
          
        </author>
      

      
        <category term="Game" />
      

      

      
        <summary type="html">（本文配图皆来自《Crowds In A Polygon Soup: Next-Gen Path Planning》By David Miles, David Miles, David Miles, David Miles 与 《Study: Navigation Mesh Generation》By Stephen Pratt。“窃书不能算偷……窃书！……读书人的事，能算偷么？”） 大家好，我是谷阿莫，今天我给大家带来的是 NavMesh 的生成方法。 这个算法从一个二维的简化例子开始讲起。当我们谈寻路算法的时候，在二维世界中，我们谈的是这样一个问题： 如下图，左边有个走廊，中间是一个通道，右边是一个骷髅状的洞穴。起点在左，目标在右，如何找到一条最为合适的路径。 在这个例子中，我们似乎很难直接求解一个合适的路径。主要的问题时，我们掌握的数据并不是一个抽象的结构化的数据。 所以，首先，我们需要从问题中产生一个抽象的结构化的数据，用来简化问题求解。</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">关于NavMesh，我所知道的</title>
      
      <link href="https://wo1fsea.github.io/2016/08/20/About_NavMesh/" rel="alternate" type="text/html" title="关于NavMesh，我所知道的" />
      <published>2016-08-20T18:37:42+00:00</published>
      <updated>2016-08-20T18:37:42+00:00</updated>
      <id>https://wo1fsea.github.io/2016/08/20/About_NavMesh</id>
      <content type="html" xml:base="https://wo1fsea.github.io/2016/08/20/About_NavMesh/">&lt;p&gt;这是一篇关于NavMesh的资料整理和总结笔记。整理了前段时间收集的NavMesh相关的资料和一个简单的算法描述。&lt;/p&gt;

&lt;p&gt;&lt;em&gt;（文章出现的所有算法描述和资料均来源于互联网，绝无半点个人原创内容，请放心阅读。）&lt;/em&gt;&lt;/p&gt;

&lt;h2&gt;Recast &amp;amp; Detour&lt;/h2&gt;
&lt;p&gt;Recast &amp;amp; Detour &lt;a href=&quot;https://github.com/recastnavigation/recastnavigation&quot;&gt;GITHUB PAGE&lt;/a&gt; 是一个开源的游戏寻路引擎，被包括Unity，UE4等游戏引擎采用。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image_RecastAndDetour.png&quot; alt=&quot;Recast &amp;amp; Detour&quot; /&gt;&lt;/p&gt;

&lt;!-- more --&gt;

&lt;p&gt;Recast &amp;amp; Detour 包括了两部分，即 Recast 和 Detour。&lt;/p&gt;

&lt;p&gt;Recast 通过将输入的场景模型体素化生成相应的寻路网格。其大概包括三个步骤：1. 体素化模型；2. 分割联通区域； 3. 将区域简化为多边形&lt;/p&gt;

&lt;p&gt;Detour 通过使用 Recast 生成的 NavMesh 进行寻路，其包括了许多算法，根据不同路径平滑程度和寻路效率要求可做不同选择。&lt;/p&gt;

&lt;p&gt;该开源库的作者 Mikko Mononen 在 AiGameDev.com 有一个相关的介绍视频 &lt;a href=&quot;http://aigamedev.com/insider/presentations/recast-teaser/&quot;&gt;Building and Traversing Navigation Meshes with Recast and Detour (Project Video)&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;Mikko Mononen 在该文章 References 部分贴出了一系列相关的参考文献。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Conservative Voxelization&lt;/strong&gt;
Long Zhang, Wei Chen, David S. Ebert, Qunsheng Peng
&lt;a href=&quot;/files/About_NavMesh/P1_Conservative_voxelization.pdf&quot;&gt;PDF&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Real-time Voxelization for Complex Polygonal Models&lt;/strong&gt;
Zhao Dong, Wei Chen, Hujun Bao, Hongxin Zhang, Qunsheng Peng
&lt;a href=&quot;/files/About_NavMesh/P2_Real-time_Voxelization_for_Complex_Models.pdf&quot;&gt;PDF&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Single-pass GPU Solid Voxelization and Applications&lt;/strong&gt;
Elmar Eisemann, Xavier Décoret
&lt;a href=&quot;/files/About_NavMesh/P3_Single-Pass_GPU_Solid_Voxelization_for_Real-Time_Applications.pdf&quot;&gt;PDF&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;GPU Gems 2: Flow Simulation with Complex Boundaries&lt;/strong&gt;
Wei Li, Zhe Fan, Xiaoming Wei, Arie Kaufman
&lt;a href=&quot;/files/About_NavMesh/P4_GPU_Gems_2_Chapter_47_Flow_Simulation_with_Complex_Boundaries.pdf&quot;&gt;PDF&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;GPU Gems 3: Real-Time Simulation and Rendering of 3D Fluids&lt;/strong&gt;
Keenan Crane, Ignacio Llamas, Sarah Tariq
&lt;a href=&quot;/files/About_NavMesh/P5_GPU_Gems_3_Real-Time_Simulation_and_Rendering_of_3D_Fluids.pdf&quot;&gt;PDF&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Way-Finder: guided tours through complex walkthrough models&lt;/strong&gt;
C. Andújar, P. Vázquez, M. Fairén
&lt;a href=&quot;/files/About_NavMesh/P6_Way-Finder_guided_tours_through_complex_walkthrough_models.pdf&quot;&gt;PDF&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Volumetric Cell-and-Portal Generation&lt;/strong&gt;
Denis Haumont, Olivier Debeir, François Sillion
&lt;a href=&quot;/files/About_NavMesh/P7_Volumetric_cell-and-portal_generation.pdf&quot;&gt;PDF&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Skeleton Extraction of 3D Objects with Visible Repulsive Force&lt;/strong&gt;
Fu-Che Wu, Wan-Chun Ma, Ping-Chou Liou, Rung-Huei Liang, Ming Ouhyoung
&lt;a href=&quot;/files/About_NavMesh/P8_Skeleton_Extraction_of 3D_Objects_with_Visible_Repulsive_Force.pdf&quot;&gt;PDF&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Automated Static and Dynamic Obstacle Avoidance in Arbitrary 3D Polygonal Worlds&lt;/strong&gt;
Edited by Xing-Jian Jing
&lt;a href=&quot;/files/About_NavMesh/P9_Automated_Static_and Dynamic_ObstacleAvoidance_in_Arbitrary_3D_Polygonal_Worlds.pdf&quot;&gt;PDF&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;A Navigation Graph for Real-time Crowd Animation on Multilayered and Uneven Terrain&lt;/strong&gt;
Julien Pettré, Jean-Paul Laumond, Daniel Thalmann
&lt;a href=&quot;/files/About_NavMesh/P10_A_navigation_graph_for_real-time_crowd_animation_on_multilayered_and_uneven_terrain.pdf&quot;&gt;PDF&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Pedestrian Reactive Navigation for Crowd Simulation: a Predictive Approach&lt;/strong&gt;
Sébastien Paris, Julien Pettré, Stéphane Donikian
&lt;a href=&quot;/files/About_NavMesh/P11_Pedestrian_Reactive_Navigation_for_Crowd_Pedestrian_Reactive_Navigation_for_Crowd_Simulation_a_Predictive_Approach.pdf&quot;&gt;PDF&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Study: Navigation Mesh Generation&lt;/h2&gt;
&lt;p&gt;Stephen Pratt 在其项目 &lt;a href=&quot;http://www.critterai.org/projects/nmgen_study/index.html&quot;&gt;《Study: Navigation Mesh Generation》&lt;/a&gt; 中提供了一个 Java 版本的 Recast 实现，并在文档中对算法细节及参数进行了详细的讨论。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image_NavigationMeshGeneration.png&quot; alt=&quot;Study: Navigation Mesh Generation&quot; /&gt;&lt;/p&gt;

&lt;p&gt;其中，&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.critterai.org/projects/nmgen_study/diffs.html&quot;&gt;《Differences Between NMGen and Recast》&lt;/a&gt;描述了其实现与 Recast &amp;amp; Detour 项目的异同之处；&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.critterai.org/projects/nmgen_study/config.html&quot;&gt;《Configuration Parameters》&lt;/a&gt;罗列了算法中各参数对生成寻路网格数据的影响。&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Crowds In A Polygon Soup: Next-Gen Path Planning&lt;/h2&gt;
&lt;p&gt;Mikko Mononen 在 Recast &amp;amp; Detour 中生成NavMesh的基本流程受到 GDC2006 上演讲&lt;a href=&quot;http://gdcvault.com/play/1013192/Crowds-In-A-Polygon-Soup&quot;&gt;《Crowds In A Polygon Soup: Next-Gen Path Planning》&lt;/a&gt;的启发。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Session:  Crowds In A Polygon Soup: Next-Gen Path Planning&lt;/strong&gt;
By David Miles, David Miles, David Miles, David Miles&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;/files/About_NavMesh/GDC-06-038.mp3&quot;&gt;Session mp3&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;/files/About_NavMesh/gdc2006_miles_david_pathplanning.ppt&quot;&gt;Session ppt&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;谷阿莫带你十分钟看完 NavMesh 生成算法&lt;/h2&gt;
&lt;p&gt;没有时间看完上面资料的同学可以看下面这个《谷阿莫带你十分钟看完 NavMesh 生成算法》的小抄。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/About_NavMesh/Image[1].png&quot; alt=&quot;谷阿莫带你十分钟看完 NavMesh 生成算法&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/2016/08/21/A_Quick_Introduction_to_NavMesh/&quot;&gt;谷阿莫带你十分钟看完 NavMesh 生成算法&lt;/a&gt;&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>wo1fsea (Quanyong Huang)</name>
          
          
        </author>
      

      
        <category term="Game" />
      

      

      
        <summary type="html">这是一篇关于NavMesh的资料整理和总结笔记。整理了前段时间收集的NavMesh相关的资料和一个简单的算法描述。 （文章出现的所有算法描述和资料均来源于互联网，绝无半点个人原创内容，请放心阅读。） Recast &amp;amp; Detour Recast &amp;amp; Detour GITHUB PAGE 是一个开源的游戏寻路引擎，被包括Unity，UE4等游戏引擎采用。</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">入职作业之 json 数据与 lua value 转换</title>
      
      <link href="https://wo1fsea.github.io/2015/01/09/Homework_Lua/" rel="alternate" type="text/html" title="入职作业之 json 数据与 lua value 转换" />
      <published>2015-01-09T13:56:39+00:00</published>
      <updated>2015-01-09T13:56:39+00:00</updated>
      <id>https://wo1fsea.github.io/2015/01/09/Homework_Lua</id>
      <content type="html" xml:base="https://wo1fsea.github.io/2015/01/09/Homework_Lua/">&lt;p&gt;题目任务描述：封装json格式的数据与lua value间的互相转换功能&lt;/p&gt;

&lt;p&gt;下载ECMA-404的描述文件，观察json的数据格式。&lt;/p&gt;

&lt;p&gt;根据描述，一个json value可以是这些类型: object, array, number, string, true, false, or null。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/value.png&quot; alt=&quot;value&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;!-- more --&gt;&lt;/p&gt;

&lt;p&gt;下面是描述几种数据类型的图。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/object.png&quot; alt=&quot;object&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/array.png&quot; alt=&quot;array&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/number.png&quot; alt=&quot;number&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/string.png&quot; alt=&quot;string&quot; /&gt;&lt;/p&gt;

&lt;p&gt;这些图的描述能力应该等同BNF，所以需要处理的操作大概有：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;串联					如，C等于A串联B(C＝AB)，即匹配一个C等同于匹配一个A接着匹配一个B&lt;/li&gt;
  &lt;li&gt;
    &lt;table&gt;
      &lt;tbody&gt;
        &lt;tr&gt;
          &lt;td&gt;并联					如，C等于A并联A(C=A&lt;/td&gt;
          &lt;td&gt;B)，即匹配一个C等同于匹配一个A或者匹配一个B&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;table&gt;
      &lt;tbody&gt;
        &lt;tr&gt;
          &lt;td&gt;匹配0或1次			如，C等于匹配A0或1次(C=A?)，即匹配一个C等同于匹配一个A0或多次，该操作可以由 C=A&lt;/td&gt;
          &lt;td&gt;”” 代替，其中”“表示空串。&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;
  &lt;/li&gt;
  &lt;li&gt;匹配0或任意次		如，C等于匹配A0或任意次(C=A*)，即匹配一个C等同于匹配一个A0或任意次&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;则最简单的，上述的value可以描述成&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;value ＝ object | array | number | string | true | false | null
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;object可以描述成，(引号内表示终结符，括号指示结合顺序)&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;object ＝ &quot;{&quot; ((string &quot;:&quot; value) (&quot;,&quot; string &quot;:&quot; value)*)? &quot;}&quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;其他就依次类推…&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;回来开始写代码：&lt;/p&gt;

&lt;p&gt;先定义最简单的匹配函数的格式：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; -- the matcher function
 function matcher(json_str, start)
 	...
 	return result, value, new_start
 end
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;最简单的匹配函数，接受一个待匹配的字符串和一个起始下标，返回匹配结果（true&lt;/td&gt;
      &lt;td&gt;false），匹配成功后的返回数据，一个新的起始下标。&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;定义两个最简单的结果处理函数，一个不处理输入直接返回，另一个直接返回nil，后面会常用到&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-- result handler
local no_h = function(v) return v end
local nil_h = function() return nil end
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;定义一个生成基本匹配函数的生成函数，接受一个lua find的匹配表达式和一个结果处理函数，返回一个匹配函数。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-- matcher function generator
local generator = function(pattern, handler)

  -- the matcher function
  function matcher(json_str, start)
    local _, e = string.find(json_str, &quot;^&quot;..pattern, start)

    if e then
      return true, handler(string.sub(json_str, start, e)), e+1
    else
      return false, nil, start
    end

  end

  return matcher
end
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;根据最开始的描述，需要的操作至少还有：并联、串联、匹配0或一次、匹配0或任意次。&lt;/p&gt;

&lt;p&gt;下面是并联多个匹配函数的并联操作，输入一个匹配函数列表和一个结果处理函数，返回一个并联后的匹配函数。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-- parallelize matchers
parallelize = function(matchers,handler)
  if handler == nil then
    handler = no_h
  end

  -- the paralleized matcher function
  function p_matcher(json_str, start)
    local r,v,s

    for i=1,#matchers do
      r,v,s = matchers[i](json_str, start)
      if r then
        if handler == nil_h then return true, nil, s end
        if handler == no_h then return true, v, s end
        return r,handler(v),s
      end
    end

    return false,nil,start
  end

  return p_matcher
end
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;下面是串联多个匹配函数的串联操作，输入一个匹配函数列表和一个结果处理函数，返回一个串联后的匹配函数。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-- serialize matchers
serialize = function(matchers,handler)
  if handler == nil then
    handler = no_h
  end

  -- the serialized matcher function
  function s_matcher(json_str, start)
    local r,v,s = false,nil,start
    local results = {}

    for i=1,#matchers do
      r,v,s = matchers[i](json_str, s)
      if r == false then
        return false,nil,start
      end
      table.insert(results,v)
    end

    if handler == nil_h then return true, nil, s end
    if handler == no_h then return true, results, s end
    return true,handler(results),s
  end

  return s_matcher
end
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;匹配0或任意次和匹配1或任意次之间存在转换关系，实现中选了1或任意次匹配作为原子操作，0或任意次可以描述为:(““表示空串)&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;0_or_more = one_or_more | &quot;&quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;下面是1或任意次匹配操作，接受一个匹配函数和一个结果处理函数，返回一个匹配1次或任意次的匹配函数。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-- make a matcher match one or more
one_or_more = function(matcher, handler)
  if handler == nil then
    handler = function(v) return v end
  end

  -- the one or more matcher function
  function oom_matcher(json_str, start)
    local r,v,s = false,nil,start
    local results = {}

    r,v,s = matcher(json_str, s)
    if r == false then
      return false,nil,s
    end
    table.insert(results,v)

    while true do
      r,v,s = matcher(json_str, s)
      if r == false then
        break
      end
      table.insert(results,v)
    end

    if handler == nil_h then return true, nil, s end
    if handler == no_h then return true, results, s end
    return true,handler(results),s
  end

  return oom_matcher
end
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;下面定义了一个空串匹配函数，和定义一个0或1次匹配操作函数。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-- empty
local empty_m = generator(&quot;&quot;,nil_h)

-- or empty helper
local or_empty = function(matcher)
  return parallelize{matcher,empty_m}
end
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;定义完这些，就可以开始描述我们的匹配函数了。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-- main matchers
local null_m, boolean_m, number_m, string_m, object_m, array_m, value_m, value_a
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;value匹配函数的描述，value为number_m,string_m,boolean_m,null_m,object_m,array_m并联。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-- value
value_m = function(json_str,s)
  -- use value_a to bootup
  if value_a==nil then
    value_a = parallelize{number_m,string_m,boolean_m,null_m,object_m,array_m}
  end
  return value_a(json_str,s)
end
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;这里的value需要使用value_a来协助描述，因为代码最终会出现循环引用，此时number_m,string_m,boolean_m,null_m,object_m,array_m都还没定义，需要在定义好后，才能生成value的匹配函数。&lt;/p&gt;

&lt;p&gt;匹配null的函数，使用生成函数生成。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-- null
null_m = generator(&quot;null&quot;,function() return nil end)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;匹配boolean的函数，true和false使用生成函数生成，然后并联true和false匹配函数，生成boolean匹配函数。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-- boolean
local true_m = generator(&quot;true&quot;, function() return true end)
local false_m = generator(&quot;false&quot;, function() return false end)
boolean_m = parallelize{true_m,false_m}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;匹配number的函数，根据最上面的图，描述为如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-- number
local sign_m = generator(&quot;[+-]?&quot;,no_h)
local minus_or_no_m = generator(&quot;[-]?&quot;,no_h)
local number_no_0_m = generator(&quot;[1-9]%d*&quot;,no_h)
local number_0_m = generator(&quot;0&quot;,no_h)
local dot_number_m = generator(&quot;%.%d+&quot;,no_h)
local e_number_m = generator(&quot;[eE][+-]?%d+&quot;,no_h)

number_m = serialize(
  {
    minus_or_no_m,
    parallelize{number_0_m,number_no_0_m},
    or_empty(dot_number_m),
    or_empty(e_number_m)
  },
  function(t) return tonumber(table.concat(t)) end
  )
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;string需要处理unicode2utf8编码转换及转义符号。&lt;/p&gt;

&lt;p&gt;unicode到utf8转换函数：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-- string
local function hex2utf8(hex)
  local v, utf8str = 0, &quot;&quot;  
  v = tonumber(hex,16)
  if v &amp;gt;= 0x0800 then
    utf8str = string.char(v%0x40+0x80)
    v = math.modf(v/0x40)
    vv = v % 0x40
    utf8str = string.char(vv+0x80) .. utf8str
    v = math.modf(v/0x40)
    utf8str = string.char(v+0xe0) .. utf8str
  elseif v &amp;gt;= 0x0080 then
    utf8str = string.char(v%0x40+0x80)
    v = math.modf(v/0x40)
    utf8str = string.char(v+0xc0) .. utf8str
  else
    utf8str = string.char(v)
  end
  return utf8str
end
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;匹配引号的函数，使用生成函数生成。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-- string
local quotation_m = generator(&quot;\&quot;&quot;,nil_h)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;匹配非”&quot;字符的函数，生成函数生成。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;local char_m = generator(&quot;[^\&quot;\\]+&quot;, no_h)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;转义表&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;local escape_char = {
    [&quot;\&quot;&quot;] = &quot;\&quot;&quot;,
    [&quot;\\&quot;] = &quot;\\&quot;,
    [&quot;/&quot;]  = &quot;/&quot;,
    [&quot;b&quot;]  = &quot;\b&quot;,
    [&quot;f&quot;]  = &quot;\f&quot;,
    [&quot;n&quot;]  = &quot;\n&quot;,
    [&quot;r&quot;]  = &quot;\r&quot;,
    [&quot;t&quot;]  = &quot;\t&quot;,
  }
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;匹配”&quot;字符函数。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;local backslash_m = generator(&quot;\\&quot;, nil_h)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;转义符号匹配和处理函数，注意传入的结果处理函数。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;local escape_char_m = generator(&quot;[\&quot;\\/bfnrt]&quot;,function(c) return escape_char[c] end)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;unicode匹配和处理函数，注意传入的结果处理函数。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;local unicode_char_m = generator(&quot;u[0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F]&quot;, function(v) return hex2utf8(string.sub(v,2)) end)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;string的描述&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;string_m = serialize(
  {
    quotation_m,
    or_empty(
        one_or_more(
          parallelize{
            char_m,
            serialize(
              {
                backslash_m,
                parallelize{escape_char_m,unicode_char_m}
              },
              table.concat
              ),
            },
          table.concat
          )
      ),
    quotation_m
  },
  table.concat
)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;object的描述，各层结果处理函数比较复杂。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-- object
-- brace_l
local brace_l_m = generator(&quot;%s*&quot; .. &quot;{&quot; .. &quot;%s*&quot;,nil_h)
local brace_r_m = generator(&quot;%s*&quot; .. &quot;}&quot; .. &quot;%s*&quot;,nil_h)
local colon_m = generator(&quot;%s*:%s*&quot;,nil_h)
local comma_m = generator(&quot;%s*,%s*&quot;,nil_h)

local object_item_m = serialize{string_m,colon_m,value_m}

object_m = serialize(
  {
    brace_l_m,
    or_empty(
      serialize(
        {
          object_item_m,
          or_empty(
            one_or_more(
              serialize(
                {comma_m,object_item_m},
                function(t) return t[1] end
              )
            )
          )
        },
        function(t)
          if t[2] then
            table.insert(t[2],t[1])
            return t[2]
          else
            return {t[1]}
          end
        end
      )
    ),
    brace_r_m
  },
  function(t)
    local o = {}

    if t[1] then
      for k,v in pairs(t[1]) do
        o[v[1]] = v[2]
      end
    end

    return o
  end
)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;array的描述，array需要保持一个状态index，如果直接用基本操作描述，传入的结果处理函数会比较蛋疼，所以用函数实现了。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-- arrary
local bracket_l_m = generator(&quot;%s*%[%s*&quot;,nil_h)
local bracket_r_m = generator(&quot;%s*%]%s*&quot;,nil_h)

array_m = function(json_str, start)

  local array,index = {}, 1
  local add_item = function(v) array[index] = v[1]; index=index+1 end
  local array_item_m = serialize({value_m},add_item)

  local array_a = serialize{
      bracket_l_m,
      or_empty(
        serialize{
            array_item_m,
            or_empty(
              one_or_more(serialize{comma_m,array_item_m})
                )
              }
          ),
      bracket_r_m
    }

  local r,v,s = array_a(json_str,start)
  return r,array,s
end
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;最后，匹配函数&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;local function Marshal(json_str)
  local result,value,start = value_m(json_str,1)
  if result and start == #json_str+1 then
    return value
  else
    return nil, &quot;error_type&quot;
  end
end
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;lua table 反解析成 json string 的比较直观，对每一种lua value类型写一个转换函数即可，此处不冗述。&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>wo1fsea (Quanyong Huang)</name>
          
          
        </author>
      

      

      

      
        <summary type="html">题目任务描述：封装json格式的数据与lua value间的互相转换功能 下载ECMA-404的描述文件，观察json的数据格式。 根据描述，一个json value可以是这些类型: object, array, number, string, true, false, or null。</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">实习离职</title>
      
      <link href="https://wo1fsea.github.io/2014/11/27/A_New_Begin/" rel="alternate" type="text/html" title="实习离职" />
      <published>2014-11-27T21:41:42+00:00</published>
      <updated>2014-11-27T21:41:42+00:00</updated>
      <id>https://wo1fsea.github.io/2014/11/27/A_New_Begin</id>
      <content type="html" xml:base="https://wo1fsea.github.io/2014/11/27/A_New_Begin/">&lt;p&gt;今天终于实习离职了，从5月8日到11月28日，在网易游戏实习了接近7个月。今天离职信里终结了下，在UniSDK，完整的东西大概做了下面这些，然后零零索索的给游戏处理各种iOS疑难杂症。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;+ NtUniSdkFramework
	+ 91
	+ PP
	+ Tongbu
	+ DownJoy
	+ iTools
	+ KuaiYong
	+ NetEase
	+ YiXin
	+ Line

+ NtShareSdkFramework
	+ YiXin
	+ WeiXin
	+ Weibo

+ NtUniSdk Xcode Plugin

+ U3D C# Wrapper for both Android and iOS NtUniSdk

+ Flash ANE for both Android and iOS NtUniSdk
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;!-- more --&gt;&lt;/p&gt;

&lt;p&gt;大半年来，还是能学到不少东西，从没接触过iOS开发，到现在许多线上的项目都用着我们的iOS UniSDK。体会最深的还是，AppStore IAP部分的代码，来来去去，踩了不少坑，也加了不少班。对一个比较长的业务流程，其实是很难保证在上线前能得到非常完备的测试的。在大量的用户面前，你完全不知道用户到底会如何使用。另外，各种概率性出现的bug也是很难重现的。比如，第一次IAP的代码上线的时候，和G3程序在重现一个0。1%概率的bug，愣是一个下午过去了，都没能重现出来，最后，也是直接靠猜了。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://ww1.sinaimg.cn/bmiddle/82a507cagw1emndj5fsn2g20dw07tnbp.gif&quot; alt=&quot;用户是这样使用我们开发的软件的&quot; /&gt;&lt;/p&gt;

&lt;p&gt;明天，就不用再考虑上班的事了，先睡几天大懒觉。
今天走的时候，一个同学说，“你居然是实习，你放着大好的时间不去浪，在这里呆了7个月？你以后会后悔的。”
可是，不实习，回来学校还是要干活的啊…&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>wo1fsea (Quanyong Huang)</name>
          
          
        </author>
      

      
        <category term="Daily" />
      

      

      
        <summary type="html">今天终于实习离职了，从5月8日到11月28日，在网易游戏实习了接近7个月。今天离职信里终结了下，在UniSDK，完整的东西大概做了下面这些，然后零零索索的给游戏处理各种iOS疑难杂症。 + NtUniSdkFramework + 91 + PP + Tongbu + DownJoy + iTools + KuaiYong + NetEase + YiXin + Line + NtShareSdkFramework + YiXin + WeiXin + Weibo + NtUniSdk Xcode Plugin + U3D C# Wrapper for both Android and iOS NtUniSdk + Flash ANE for both Android and iOS NtUniSdk</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">推荐一个系列视频《Extra Credits》</title>
      
      <link href="https://wo1fsea.github.io/2014/11/26/Extra_Credits/" rel="alternate" type="text/html" title="推荐一个系列视频《Extra Credits》" />
      <published>2014-11-26T16:43:39+00:00</published>
      <updated>2014-11-26T16:43:39+00:00</updated>
      <id>https://wo1fsea.github.io/2014/11/26/Extra_Credits</id>
      <content type="html" xml:base="https://wo1fsea.github.io/2014/11/26/Extra_Credits/">&lt;p&gt;最近中午的午休时间都在看&lt;a href=&quot;http://extra-credits.net/&quot;&gt;《Extra Credits》&lt;/a&gt;，挺赞的，是一个讨论游戏行业相关话题的系列视频。在此推荐一下。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/extra_credits.png&quot; alt=&quot;Extra Credits&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;!-- more --&gt;&lt;/p&gt;

&lt;p&gt;这是wikipedia上的介绍。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Extra Credits is a video lesson series presented by game designer James Portnow, animator/narrator Daniel Floyd, and artists Allison Theus, Elisa “LeeLee” Scaldaferri, Scott DeWitt, and Dan Jones. The series of videos discuss issues pertinent to video games and game studies, particularly discussing issues concerning video game development, addressing the legitimacy of video games as art, and creating intellectual discourse on important issues in gaming culture.[1]&lt;/p&gt;

  &lt;p&gt;– WIKIPEDIA&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Links:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://extra-credits.net/&quot;&gt;Official Website&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.youtube.com/user/ExtraCreditz&quot;&gt;Extra Credits’s channel on YouTube&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Extra_Credits&quot;&gt;the wikipedia link fo Extra Credits&lt;/a&gt;&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>wo1fsea (Quanyong Huang)</name>
          
          
        </author>
      

      
        <category term="Daily" />
      

      

      
        <summary type="html">最近中午的午休时间都在看《Extra Credits》，挺赞的，是一个讨论游戏行业相关话题的系列视频。在此推荐一下。</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">黑魔法之Xcode Plugin开发</title>
      
      <link href="https://wo1fsea.github.io/2014/11/24/Black_Magic_Xcode_Plugin/" rel="alternate" type="text/html" title="黑魔法之Xcode Plugin开发" />
      <published>2014-11-24T14:42:01+00:00</published>
      <updated>2014-11-24T14:42:01+00:00</updated>
      <id>https://wo1fsea.github.io/2014/11/24/Black_Magic_Xcode_Plugin</id>
      <content type="html" xml:base="https://wo1fsea.github.io/2014/11/24/Black_Magic_Xcode_Plugin/">&lt;p&gt;Xcode 插件的黑科技&lt;/p&gt;

&lt;p&gt;##1. 取得项目路径&lt;/p&gt;

&lt;p&gt;先贴段代码：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;NSString *workspacePath = @&quot;&quot;;

// to find current project path
NSArray *workspaceWindowControllers = [NSClassFromString(@&quot;IDEWorkspaceWindowController&quot;) valueForKey:@&quot;workspaceWindowControllers&quot;];
id workSpace;
for (id controller in workspaceWindowControllers) {
    if ([[controller valueForKey:@&quot;window&quot;] isEqual:[NSApp keyWindow]]) {
        workSpace = [controller valueForKey:@&quot;_workspace&quot;];
    }
}

if (workSpace) {
    workspacePath = [[workSpace valueForKey:@&quot;representingFilePath&quot;] valueForKey:@&quot;_pathString&quot;];
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;这段代码位于 BMPlugin.m 中，作用是取得当前 workspace，并读取其文件路径。&lt;/p&gt;

&lt;p&gt;&lt;!-- more --&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;由于 Xcode 插件开发基本无文档可查，这段代码也是从网上 copy 回来的。完全没有系统了解的方法。&lt;/p&gt;

  &lt;p&gt;值得注意的是，这些都不是公开的API，所以，Xcode 版本迭代时，注意检查兼容性。&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;##2. 标示支持的 Xcode 版本&lt;/p&gt;

&lt;p&gt;插件项目的 info.plist 需要添加 DVTPlugInCompatibilityUUIDs 标示支持的 Xcode 版本。&lt;/p&gt;

&lt;p&gt;当前 Xcode 版本的 DVTPlugInCompatibilityUUID 可在 Xcode.app/Contents/Info.plist 找到。&lt;/p&gt;

&lt;p&gt;如果对应 Xcode 版本的 DVTPlugInCompatibilityUUID 没有被添加到 info.plist 中，那么该版本 Xcode 启动时不会加载插件。&lt;/p&gt;

&lt;p&gt;##3. XCPluginHasUI NO&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Set XCPluginHasUI in Info.plist to YES to disable your plugin&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;记得这个属性 XCPluginHasUI 需要设置为 NO。&lt;/p&gt;

&lt;p&gt;##4. 其他需要注意的&lt;/p&gt;

&lt;p&gt;编译的时候记得把 .xib 界面文件添加到 Compile Sources 里面，否则，编译出来的包里面没有对应的 .nib 。&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>wo1fsea (Quanyong Huang)</name>
          
          
        </author>
      

      
        <category term="iOS" />
      

      

      
        <summary type="html">Xcode 插件的黑科技 ##1. 取得项目路径 先贴段代码： NSString *workspacePath = @&quot;&quot;; // to find current project path NSArray *workspaceWindowControllers = [NSClassFromString(@&quot;IDEWorkspaceWindowController&quot;) valueForKey:@&quot;workspaceWindowControllers&quot;]; id workSpace; for (id controller in workspaceWindowControllers) { if ([[controller valueForKey:@&quot;window&quot;] isEqual:[NSApp keyWindow]]) { workSpace = [controller valueForKey:@&quot;_workspace&quot;]; } } if (workSpace) { workspacePath = [[workSpace valueForKey:@&quot;representingFilePath&quot;] valueForKey:@&quot;_pathString&quot;]; } 这段代码位于 BMPlugin.m 中，作用是取得当前 workspace，并读取其文件路径。</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">关于AppStore IAP的新旧Receipt</title>
      
      <link href="https://wo1fsea.github.io/2014/08/17/About_IAP_Receipt/" rel="alternate" type="text/html" title="关于AppStore IAP的新旧Receipt" />
      <published>2014-08-17T13:27:40+00:00</published>
      <updated>2014-08-17T13:27:40+00:00</updated>
      <id>https://wo1fsea.github.io/2014/08/17/About_IAP_Receipt</id>
      <content type="html" xml:base="https://wo1fsea.github.io/2014/08/17/About_IAP_Receipt/">&lt;p&gt;iOS7.0后，SKPayment的property transactionReceipt变成了DEPRECATED。&lt;/p&gt;

&lt;p&gt;建议使用新接口来实现receipt的获取。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; [[[NSBundle mainBundle] appStoreReceiptURL] dataWithContentsOfURL:receiptURL];
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;如果使用了IAP，Apple官方的建议是使用下列代码来处理：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;NSData *receipt = nil;

if (floor(NSFoundationVersionNumber) &amp;lt;= NSFoundationVersionNumber_iOS_6_1) {
    // Load resources for iOS 6.1 or earlier
    receipt = transaction.transactionReceipt;

} else {
    NSURL *receiptURL = [[NSBundle mainBundle] appStoreReceiptURL];
    receipt = [NSData dataWithContentsOfURL:receiptURL];
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;上面的代码很容易以为，新旧接口取得的receipt格式是一致的。其实不然。&lt;/p&gt;

&lt;p&gt;&lt;!-- more --&gt;&lt;/p&gt;

&lt;p&gt;在NtUniSdk里面,iOS官方渠道的易信和网易通行证使用了IAP,然后使用了上述Apple官方建议的代码，结果就是receipt格式不一致，计费验证不通过，把接入SDK的G3坑了一顿。&lt;/p&gt;

&lt;p&gt;原来旧接口返回的receipt如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;2014-07-24 15:53:51.284 [NetEase]iOSNtUniSdkFrameworkDemo[22831:4107] [NtUniSdk] IAP jsonResponse: {
	receipt =     {
    	bid = &quot;com.netease.sdk.test&quot;;
    	bvrs = &quot;1.0&quot;;
    	&quot;item_id&quot; = 892617314;
    	&quot;original_purchase_date&quot; = &quot;2014-07-24 07:43:14 Etc/GMT&quot;;
    	&quot;original_purchase_date_ms&quot; = 1406187794660;
    	&quot;original_purchase_date_pst&quot; = &quot;2014-07-24 00:43:14 America/Los_Angeles&quot;;
    	&quot;original_transaction_id&quot; = 1000000117879059;
    	&quot;product_id&quot; = &quot;com.netease.sdk.test.item2&quot;;
    	&quot;purchase_date&quot; = &quot;2014-07-24 07:43:14 Etc/GMT&quot;;
    	&quot;purchase_date_ms&quot; = 1406187794660;
    	&quot;purchase_date_pst&quot; = &quot;2014-07-24 00:43:14 America/Los_Angeles&quot;;
    	quantity = 1;
    	&quot;transaction_id&quot; = 1000000117879059;
    	&quot;unique_identifier&quot; = 0000b0196818;
    	&quot;unique_vendor_identifier&quot; = &quot;FEF4F2DB-D07D-4B96-8F22-592A4B9CBAE7&quot;;
	};
	status = 0;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;而新接口返回的receipt：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;2014-07-24 17:11:16.475 [NetEase]iOSNtUniSdkFrameworkDemo[185:748f] [NtUniSdk] IAP jsonResponse: {
	environment = Sandbox;
	receipt =     {
    	&quot;adam_id&quot; = 0;
    	&quot;application_version&quot; = &quot;1.0&quot;;
    	&quot;bundle_id&quot; = &quot;com.netease.sdk.test&quot;;
    	&quot;download_id&quot; = 0;
    	&quot;in_app&quot; =         (
                    	{
            	&quot;is_trial_period&quot; = false;
            	&quot;original_purchase_date&quot; = &quot;2014-07-24 09:11:00 Etc/GMT&quot;;
            	&quot;original_purchase_date_ms&quot; = 1406193060000;
            	&quot;original_purchase_date_pst&quot; = &quot;2014-07-24 02:11:00 America/Los_Angeles&quot;;
            	&quot;original_transaction_id&quot; = 1000000117894869;
            	&quot;product_id&quot; = &quot;com.netease.sdk.test.item2&quot;;
            	&quot;purchase_date&quot; = &quot;2014-07-24 09:11:01 Etc/GMT&quot;;
            	&quot;purchase_date_ms&quot; = 1406193061000;
            	&quot;purchase_date_pst&quot; = &quot;2014-07-24 02:11:01 America/Los_Angeles&quot;;
            	quantity = 1;
            	&quot;transaction_id&quot; = 1000000117894869;
        	}
    	);
    	&quot;original_application_version&quot; = &quot;1.0&quot;;
    	&quot;original_purchase_date&quot; = &quot;2013-08-01 07:00:00 Etc/GMT&quot;;
    	&quot;original_purchase_date_ms&quot; = 1375340400000;
    	&quot;original_purchase_date_pst&quot; = &quot;2013-08-01 00:00:00 America/Los_Angeles&quot;;
    	&quot;receipt_type&quot; = ProductionSandbox;
    	&quot;request_date&quot; = &quot;2014-07-24 09:11:17 Etc/GMT&quot;;
    	&quot;request_date_ms&quot; = 1406193077021;
    	&quot;request_date_pst&quot; = &quot;2014-07-24 02:11:17 America/Los_Angeles&quot;;
	};
	status = 0;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;新旧receipt在验证API接口方面无变化，变化主要在于返回的jsonResponese格式。
新的jsonResponese格式官网文档如下：&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Receipt Fields
https://developer.apple.com/library/ios/releasenotes/General/ValidateAppStoreReceipt/Chapters/ReceiptFields.html#//apple_ref/doc/uid/TP40010573-CH106-SW1&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;下面是程序中实际输出jsonResponese的Log，值得注意的有receipt字段中的in_app字段可能包含多个transaction的receipt。
客户端APP中的新接口每次读取将读取出还没读取过的所有receipt，当上一次transaction完成后，但没有成功调用到读取receipt接口时，即将出现多条，如下第二条Log所示。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;2014-07-24 16:06:52.077 [NetEase]iOSNtUniSdkFrameworkDemo[164:3e0b] [NtUniSdk] IAP jsonResponse: {
	environment = Sandbox;
	receipt =     {
    	&quot;adam_id&quot; = 0;
    	&quot;application_version&quot; = &quot;1.0&quot;;
    	&quot;bundle_id&quot; = &quot;com.netease.sdk.test&quot;;
    	&quot;download_id&quot; = 0;
    	&quot;in_app&quot; =         (
        	            {
            	&quot;is_trial_period&quot; = false;
            	&quot;original_purchase_date&quot; = &quot;2014-06-23 06:59:55 Etc/GMT&quot;;
            	&quot;original_purchase_date_ms&quot; = 1403506795000;
            	&quot;original_purchase_date_pst&quot; = &quot;2014-06-22 23:59:55 America/Los_Angeles&quot;;
            	&quot;original_transaction_id&quot; = 1000000114795007;
            	&quot;product_id&quot; = &quot;com.netease.sdk.test.item1&quot;;
            	&quot;purchase_date&quot; = &quot;2014-06-24 09:06:09 Etc/GMT&quot;;
            	&quot;purchase_date_ms&quot; = 1403600769000;
            	&quot;purchase_date_pst&quot; = &quot;2014-06-24 02:06:09 America/Los_Angeles&quot;;
            	quantity = 1;
            	&quot;transaction_id&quot; = 1000000114795007;
        	},
            	        {
            	&quot;is_trial_period&quot; = false;
            	&quot;original_purchase_date&quot; = &quot;2014-06-24 09:06:09 Etc/GMT&quot;;
            	&quot;original_purchase_date_ms&quot; = 1403600769000;
            	&quot;original_purchase_date_pst&quot; = &quot;2014-06-24 02:06:09 America/Los_Angeles&quot;;
            	&quot;original_transaction_id&quot; = 1000000114938703;
            	&quot;product_id&quot; = &quot;com.netease.sdk.test.item3&quot;;
            	&quot;purchase_date&quot; = &quot;2014-06-24 09:06:09 Etc/GMT&quot;;
            	&quot;purchase_date_ms&quot; = 1403600769000;
            	&quot;purchase_date_pst&quot; = &quot;2014-06-24 02:06:09 America/Los_Angeles&quot;;
            	quantity = 1;
            	&quot;transaction_id&quot; = 1000000114938703;
        	}
    	);
    	&quot;original_application_version&quot; = &quot;1.0&quot;;
    	&quot;original_purchase_date&quot; = &quot;2013-08-01 07:00:00 Etc/GMT&quot;;
    	&quot;original_purchase_date_ms&quot; = 1375340400000;
    	&quot;original_purchase_date_pst&quot; = &quot;2013-08-01 00:00:00 America/Los_Angeles&quot;;
    	&quot;receipt_type&quot; = ProductionSandbox;
    	&quot;request_date&quot; = &quot;2014-07-24 08:06:54 Etc/GMT&quot;;
    	&quot;request_date_ms&quot; = 1406189214105;
    	&quot;request_date_pst&quot; = &quot;2014-07-24 01:06:54 America/Los_Angeles&quot;;
   		};
	status = 0;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Apple的IAP一直存在一个比较蛋疼的问题，在IAP的交易订单上没有填写额外信息的地方。由于存在网游的账号和AppStore支付账号两套系统，道具发放一直存在着可能在支付过程意外中断而导致漏洞的情况。iOS7.0在SKPayment中提供了一个applicationUsername属性用于填写用户信息，不过鉴于iOS7.0－的系统中没有该属性，在短时间内对这种意外情况改善也不大。&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>wo1fsea (Quanyong Huang)</name>
          
          
        </author>
      

      
        <category term="iOS" />
      

      

      
        <summary type="html">iOS7.0后，SKPayment的property transactionReceipt变成了DEPRECATED。 建议使用新接口来实现receipt的获取。 [[[NSBundle mainBundle] appStoreReceiptURL] dataWithContentsOfURL:receiptURL]; 如果使用了IAP，Apple官方的建议是使用下列代码来处理： NSData *receipt = nil; if (floor(NSFoundationVersionNumber) &amp;lt;= NSFoundationVersionNumber_iOS_6_1) { // Load resources for iOS 6.1 or earlier receipt = transaction.transactionReceipt; } else { NSURL *receiptURL = [[NSBundle mainBundle] appStoreReceiptURL]; receipt = [NSData dataWithContentsOfURL:receiptURL]; } 上面的代码很容易以为，新旧接口取得的receipt格式是一致的。其实不然。</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">U3D iOS SDK Wrapper</title>
      
      <link href="https://wo1fsea.github.io/2014/08/17/U3D_iOS_Wrapper/" rel="alternate" type="text/html" title="U3D iOS SDK Wrapper" />
      <published>2014-08-17T10:47:54+00:00</published>
      <updated>2014-08-17T10:47:54+00:00</updated>
      <id>https://wo1fsea.github.io/2014/08/17/U3D_iOS_Wrapper</id>
      <content type="html" xml:base="https://wo1fsea.github.io/2014/08/17/U3D_iOS_Wrapper/">&lt;p&gt;很多游戏使用U3D引擎，比如《忍者必须死》、《影之刃》… 所以，iOS NtUniSDK需要一个U3D的wrapper。&lt;/p&gt;

&lt;p&gt;U3D的C#可以调用外部C接口，故需要为NtUniSDK包装一个C语言层，下面给出简化的项目示例代码。&lt;/p&gt;

&lt;p&gt;&lt;!-- more --&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#import &quot;UnityAppController.h&quot;
&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#import &quot;UniHead.h&quot;
&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#pragma mark __NtNotificationWrapper
&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#define GameObject &quot;Main Camera&quot;
&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#if defined(__cplusplus)
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;C&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;	&lt;span class=&quot;k&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UnitySendMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#if defined(__cplusplus)
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;__NtNotificationWrapper&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NSObject&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;@end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__NtNotificationWrapper&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__inst&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;__NtNotificationWrapper&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initialize&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__inst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;n&quot;&gt;__inst&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__NtNotificationWrapper&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

	&lt;span class=&quot;c1&quot;&gt;//初始化通知
&lt;/span&gt;	&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSNotificationCenter&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;defaultCenter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;addObserver&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__inst&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;@selector&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;finishInitNotification&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NT_NOTIFICATION_FINISH_INIT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;


&lt;span class=&quot;c1&quot;&gt;//初始化完成处理
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;finishInitNotification&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSNotification&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;notification&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   		&lt;span class=&quot;n&quot;&gt;NSLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;[NtUniSdk] Notification finishInit.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;UnitySendMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GameObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;NT_NOTIFICATION_FINISH_INIT&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;


&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;doNothing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;@end&lt;/span&gt;


&lt;span class=&quot;cp&quot;&gt;#pragma mark - __NtSdkMgr_X
&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#if defined(__cplusplus)
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;C&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__makeCString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cstring&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;cStringUsingEncoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSUTF8StringEncoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cstring&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;malloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cstring&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;strcpy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cstring&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__makeNSString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cstring&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cstring&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nsstring&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initWithCString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cstring&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSUTF8StringEncoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nsstring&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__NtSdkMgr_ntInit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__NtNotificationWrapper&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;doNothing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NtSdkMgr&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ntInit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;#if defined(__cplusplus)
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;注意上述代码中，对Notification的传递使用了&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;extern void UnitySendMessage(const char *, const char *, const char *);
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;调用GameObject上的回调函数。&lt;/p&gt;

&lt;p&gt;回到U3D，新建一个C#文件，实现SDK的C# Wrapper。下面是简化的代码示例：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;using UnityEngine;

using System;
using System.Collections;
using System.Collections.Generic;
using System.Runtime.InteropServices;
using System.Text;

namespace NtUniSdk{
	namespace Unity3d{
		public class SdkU3d : MonoBehaviour
		{

			public static void ntInit()
			{
				__NtSdkMgr_ntInit();
			}

			[DllImport(&quot;__Internal&quot;)]
			private static extern void __NtSdkMgr_ntInit();

		};

	}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;在U3D中即可使用该Wrapper操作SDK。&lt;/p&gt;

&lt;p&gt;在U3D中将工程导出为Xcode工程，向Xcode中添加上述完成的C包装层，同时，按文档正常接入NtUniSDK。&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>wo1fsea (Quanyong Huang)</name>
          
          
        </author>
      

      
        <category term="iOS" />
      

      

      
        <summary type="html">很多游戏使用U3D引擎，比如《忍者必须死》、《影之刃》… 所以，iOS NtUniSDK需要一个U3D的wrapper。 U3D的C#可以调用外部C接口，故需要为NtUniSDK包装一个C语言层，下面给出简化的项目示例代码。</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">黑魔法之 iOS Flash ANE 打包</title>
      
      <link href="https://wo1fsea.github.io/2014/08/14/Black_Magic_Flash_iOS_ANE/" rel="alternate" type="text/html" title="黑魔法之 iOS Flash ANE 打包" />
      <published>2014-08-14T18:09:46+00:00</published>
      <updated>2014-08-14T18:09:46+00:00</updated>
      <id>https://wo1fsea.github.io/2014/08/14/Black_Magic_Flash_iOS_ANE</id>
      <content type="html" xml:base="https://wo1fsea.github.io/2014/08/14/Black_Magic_Flash_iOS_ANE/">&lt;p&gt;MA6-僵尸 使用Flash Air开发，故iOS SDK需包装一个Flash ANE版本。&lt;/p&gt;

&lt;p&gt;用到的环境有：Flash Builder 4.7、Xcode 5.1.1、iOS SDK 7.1&lt;/p&gt;

&lt;h2&gt;Flash Flex 项目&lt;/h2&gt;

&lt;p&gt;在Flash Buildder中建立一个 &lt;strong&gt;Flex手机项目库&lt;/strong&gt; ，新建一个.as脚本，实现as的wrapper。
下面给了个简化的项目示例，注意其中用于实现回调的onStatus和初始化函数NtUniSdk4Flash。&lt;/p&gt;

&lt;p&gt;&lt;!-- more --&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;package com.netease.ntunisdk
{
	import flash.events.EventDispatcher;
	import flash.events.StatusEvent;
	import flash.external.ExtensionContext;

	public class NtUniSdk4Flash extends EventDispatcher
	{
		private static var _instance:NtUniSdk4Flash;
		private var extContext:ExtensionContext;

		public function ntInit():void
		{
			extContext.call( &quot;__NtSdkMgr_ntInit&quot; );
		}

		public static function get instance():NtUniSdk4Flash {
			if ( !_instance ) {
				_instance = new NtUniSdk4Flash( new SingletonEnforcer() );
			}
			return _instance;
		}

		public function dispose():void {
			extContext.dispose();
		}

		private function onStatus( event:StatusEvent ):void {
			dispatchEvent( new SDKNotification(event.code, false, false) );
		}


		/**
	 	* Constructor.
	 	*/		
		public function NtUniSdk4Flash( enforcer:SingletonEnforcer ) {
			super();

			extContext = ExtensionContext.createExtensionContext( &quot;com.netease.ntunisdk.ios.ane&quot;, &quot;&quot; );

			if ( !extContext ) {
				throw new Error( &quot;iOS NtUniSdk native extension is not supported on this platform.&quot; );
			}

			extContext.addEventListener( StatusEvent.STATUS, onStatus );
		}
	}
}

class SingletonEnforcer {

}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;然后需要再建立一个extension.xml，示例再如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;extension xmlns=&quot;http://ns.adobe.com/air/extension/3.1&quot;&amp;gt;
	&amp;lt;id&amp;gt;com.netease.ntunisdk.ios.ane&amp;lt;/id&amp;gt;
	&amp;lt;versionNumber&amp;gt;0.0.1&amp;lt;/versionNumber&amp;gt;
	&amp;lt;platforms&amp;gt;  
		&amp;lt;platform name=&quot;iPhone-ARM&quot;&amp;gt;
        	&amp;lt;applicationDeployment&amp;gt;
            	&amp;lt;nativeLibrary&amp;gt;liblibNtUniSdk4Flash.a&amp;lt;/nativeLibrary&amp;gt;
            	&amp;lt;initializer&amp;gt;ExtInitializer&amp;lt;/initializer&amp;gt;
        	&amp;lt;/applicationDeployment&amp;gt;
    	&amp;lt;/platform&amp;gt;
	&amp;lt;/platforms&amp;gt;
&amp;lt;/extension&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;因为我们需要的只是iphone版本的ANE，所以只有iPhone-ARM一个平台。com.netease.ntunisdk.ios.ane和上面as代码中的ExtensionContext.createExtensionContext参数是对应的。&lt;/p&gt;

&lt;p&gt;然后，在菜单里，选择 项目 -&amp;gt; 构建项目，编译项目。如果你的构建项目事灰色的，那是打开了自动构建。把 项目 -&amp;gt; 自动构建 取消掉。&lt;/p&gt;

&lt;p&gt;这时候，可以等到 &lt;strong&gt;产出1. 一个.swc文件&lt;/strong&gt; 。&lt;/p&gt;

&lt;h2&gt;Xcode 静态库项目&lt;/h2&gt;

&lt;p&gt;建立一个Coco Touch Static Library, 在Air SDK里找到 FlashRuntimeExtensions.h，添加到项目中。&lt;/p&gt;

&lt;p&gt;新建一个.m文件，下面给出项目简化版的示例：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;//
//  libNtUniSdk4Flash.m
//  libNtUniSdk4Flash
//
//  Created by Huang Quanyong on 14-8-7.
//  Copyright (c) 2014年 Stupid Dumb Kids. All rights reserved.
//
&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#import &quot;FlashRuntimeExtensions.h&quot;
#import &quot;UniHead.h&quot;
&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#define STRING_BUFFER_SIZE 1024*128
&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;__NtNotificationWrapper&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NSObject&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;@end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__NtNotificationWrapper&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__inst&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FREContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__context&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;__NtNotificationWrapper&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initialize&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__inst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

   		__inst = [[__NtNotificationWrapper alloc] init];

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	&lt;span class=&quot;c1&quot;&gt;//初始化通知
&lt;/span&gt;	&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSNotificationCenter&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;defaultCenter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;addObserver&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__inst&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;@selector&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;finishInitNotification&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NT_NOTIFICATION_FINISH_INIT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;//初始化完成处理
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;finishInitNotification&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSNotification&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;notification&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   		&lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;str&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NT_NOTIFICATION_FINISH_INIT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;uint8_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;code&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;uint8_t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;str&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;UTF8String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;FREDispatchStatusEventAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;NSLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;[NtUniSdk] Notification finishInit.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;doNothing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;@end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;FREObject&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__NtSdkMgr_ntInit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FREContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;funcData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FREObject&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[])&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;NSLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;[NtUniSdk] __NtSdkMgr_ntInit&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__NtNotificationWrapper&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;doNothing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NtSdkMgr&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ntInit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// InitNativeCode()
//
// An InitNativeCode function is necessary in the Android implementation of this extension.
// Therefore, an analogous function is necessary in the iOS implementation to make
// the ActionScript interface identical for all implementations.
// However, the iOS implementation has nothing to do.
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FREObject&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InitNativeCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FREContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;funcData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FREObject&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

	&lt;span class=&quot;n&quot;&gt;NSLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;Entering InitNativeCode()&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

	&lt;span class=&quot;c1&quot;&gt;// Nothing to do.
&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;NSLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;Exiting InitNativeCode()&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// ContextInitializer()
//
// The context initializer is called when the runtime creates the extension context instance.
&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ContextInitializer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;extData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;uint8_t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ctxType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FREContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;uint32_t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;numFunctionsToTest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FRENamedFunction&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;functionsToSet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

	&lt;span class=&quot;n&quot;&gt;NSLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;Entering ContextInitializer()&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

	&lt;span class=&quot;n&quot;&gt;__context&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;numFunctionsToTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;FRENamedFunction&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FRENamedFunction&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;malloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FRENamedFunction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;numFunctionsToTest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

	&lt;span class=&quot;c1&quot;&gt;//Just for consistency with Android
&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;uint8_t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;__NtSdkMgr_ntInit&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;functionData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__NtSdkMgr_ntInit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;functionsToSet&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;n&quot;&gt;NSLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;Exiting ContextInitializer()&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// ContextFinalizer()
//
// The context finalizer is called when the extension's ActionScript code
// calls the ExtensionContext instance's dispose() method.
// If the AIR runtime garbage collector disposes of the ExtensionContext instance, the runtime also calls
// ContextFinalizer().
&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ContextFinalizer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FREContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

   	 	NSLog(@”Entering ContextFinalizer()”);

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	// Nothing to clean up.

	NSLog(@&quot;Exiting ContextFinalizer()&quot;);

	return;
}

// ExtInitializer()
//
// The extension initializer is called the first time the ActionScript side of the extension
// calls ExtensionContext.createExtensionContext() for any context.

void ExtInitializer(void** extDataToSet, FREContextInitializer* ctxInitializerToSet, FREContextFinalizer* ctxFinalizerToSet) {

	NSLog(@&quot;Entering ExtInitializer()&quot;);

	*extDataToSet = NULL;
	*ctxInitializerToSet = &amp;amp;ContextInitializer;
	*ctxFinalizerToSet = &amp;amp;ContextFinalizer;

	NSLog(@&quot;Exiting ExtInitializer()&quot;);
}

// ExtFinalizer()
//
// The extension finalizer is called when the runtime unloads the extension. However, it is not always called.

void ExtFinalizer(void* extData) {

	NSLog(@&quot;Entering ExtFinalizer()&quot;);

	// Nothing to clean up.

	NSLog(@&quot;Exiting ExtFinalizer()&quot;);
	return;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;注意中间消息的回调实现，调用FREDispatchStatusEventAsync，会触发as里的onStatus。&lt;/p&gt;

&lt;p&gt;编译该项目，得到 &lt;strong&gt;产出2.一个.a文件&lt;/strong&gt; ，即是extension.xml中的&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;nativeLibrary&amp;gt;liblibNtUniSdk4Flash.a&amp;lt;/nativeLibrary&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2&gt;编译ANE&lt;/h2&gt;

&lt;p&gt;编译ANE的过程简直就是黑魔法。&lt;/p&gt;

&lt;p&gt;建立一个platform.xml，写入库依赖连接信息，以iTools SDK为例。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;platform xmlns=&quot;http://ns.adobe.com/air/extension/3.1&quot;&amp;gt;
	&amp;lt;description&amp;gt;An optional description.&amp;lt;/description&amp;gt;
	&amp;lt;copyright&amp;gt;2011 (optional)&amp;lt;/copyright&amp;gt;
	&amp;lt;sdkVersion&amp;gt;5.0.0&amp;lt;/sdkVersion&amp;gt;
	&amp;lt;linkerOptions&amp;gt;
    	&amp;lt;option&amp;gt;-ios_version_min 5.0&amp;lt;/option&amp;gt;
    	&amp;lt;option&amp;gt;-framework AdSupport&amp;lt;/option&amp;gt;
    	&amp;lt;option&amp;gt;-framework SystemConfiguration&amp;lt;/option&amp;gt;
    	&amp;lt;option&amp;gt;-framework CFNetwork&amp;lt;/option&amp;gt;
    	&amp;lt;option&amp;gt;-framework Security&amp;lt;/option&amp;gt;
    	&amp;lt;option&amp;gt;-framework MobileCoreServices&amp;lt;/option&amp;gt;
    	&amp;lt;option&amp;gt;-framework QuartzCore&amp;lt;/option&amp;gt;
    	&amp;lt;option&amp;gt;-framework CoreTelephony&amp;lt;/option&amp;gt;

    	&amp;lt;option&amp;gt;-framework StoreKit&amp;lt;/option&amp;gt;
    	&amp;lt;option&amp;gt;-framework NtUniSdkiTools&amp;lt;/option&amp;gt;

    	&amp;lt;option&amp;gt;-lc /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS7.1.sdk/usr/lib/libz.dylib&amp;lt;/option&amp;gt;
	&amp;lt;/linkerOptions&amp;gt;
&amp;lt;/platform&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;把产出1的.swc文件，后缀改为.zip，解压，得到catalog.xml和library.swf。&lt;/p&gt;

&lt;p&gt;建立一个文件夹，命名为iPhone-ARM，放入三个文件，上一步所得的catalog.xml和library.swf、产出1.的.a文件。&lt;/p&gt;

&lt;p&gt;新建一个目录，放入如下：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;上文的iPhone-ARM文件夹&lt;/li&gt;
  &lt;li&gt;上文的platform.xml&lt;/li&gt;
  &lt;li&gt;上文的extension.xml&lt;/li&gt;
  &lt;li&gt;产出1.的NtUniSdk4Flash.swc&lt;/li&gt;
  &lt;li&gt;developer_identity.p12 用于签名的证书，密码为111111 (没有的话，可是用Flash Builder生成，请看后面步骤)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;用以下指令编译ANE：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&quot;/Applications/Adobe Flash Builder 4.7/sdks/4.6.0/bin/adt&quot; \
	-package -storetype pkcs12 -keystore developer_identity.p12 -storepass 111111 \
	-target com.netease.ntunisdk.ios.ane extension.xml -swc NtUniSdk4Flash.swc -platform iPhone-ARM -C iPhone-ARM  -platformoptions platform.xml  .
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;然后，你就生成了一个可用的ANE文件。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;没有developer_identity.p12证书&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;请新建一个Flex手机工程，在工程上点击右键，选择属性，并选择 Flex构建打包 -&amp;gt; Apple iOS，在右边选择 数字签名 -&amp;gt; 创建，即可创建一个可用的数字签名证书。&lt;/p&gt;
&lt;/blockquote&gt;</content>

      
      
      
      
      

      
        <author>
            <name>wo1fsea (Quanyong Huang)</name>
          
          
        </author>
      

      
        <category term="iOS" />
      

      

      
        <summary type="html">MA6-僵尸 使用Flash Air开发，故iOS SDK需包装一个Flash ANE版本。 用到的环境有：Flash Builder 4.7、Xcode 5.1.1、iOS SDK 7.1 Flash Flex 项目 在Flash Buildder中建立一个 Flex手机项目库 ，新建一个.as脚本，实现as的wrapper。 下面给了个简化的项目示例，注意其中用于实现回调的onStatus和初始化函数NtUniSdk4Flash。</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">A New Blog</title>
      
      <link href="https://wo1fsea.github.io/2014/07/17/A_New_Blog/" rel="alternate" type="text/html" title="A New Blog" />
      <published>2014-07-17T00:25:34+00:00</published>
      <updated>2014-07-17T00:25:34+00:00</updated>
      <id>https://wo1fsea.github.io/2014/07/17/A_New_Blog</id>
      <content type="html" xml:base="https://wo1fsea.github.io/2014/07/17/A_New_Blog/">&lt;p&gt;折腾了几天，先post上第一篇。&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>wo1fsea (Quanyong Huang)</name>
          
          
        </author>
      

      
        <category term="Daily" />
      

      

      
        <summary type="html">折腾了几天，先post上第一篇。</summary>
      

      
      
    </entry>
  
  
</feed>
